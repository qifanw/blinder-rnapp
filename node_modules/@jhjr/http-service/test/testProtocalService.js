var HttpService = require('../index');// text/index.js文件中已经实例化过HttpService对象，这里直接取出实例化之后的defaultService属性
var testIndex = require('./index');
var protocalService = HttpService.$getDefaultService().$getProtocalService();
var userService = HttpService.$getDefaultService().$getUserService();

describe('测试购买协议接口', function(done){
  this.timeout(5000);

  var mobile = '11143211240';
  before(function () {
    return userService.$login(mobile, '111111').then(function (result) {
      HttpService.$getDefaultService().$setUserInfo(result);
    });
  });

  it('should return code(0)', function(){
    return protocalService.$getDealProtocal('999150', 'buy').should.eventually.satisfy(function(obj){
      return obj.message.code == 0
    }).notify(done);
  });
});

describe('测试爽活宝认购合同', function(done){
  this.timeout(5000);


  it('爽活宝 protocal should return code(0)', function(){
    return protocalService.$getShbProtocal('GY0002').should.eventually.satisfy(function(obj){
      return obj.message.code == 0
    }).notify(done);
  });

  it('新人宝 protocal should return code(0)', function(){
    return protocalService.$getShbProtocal('GY0001').should.eventually.satisfy(function(obj){
      return obj.message.code == 0
    }).notify(done);
  });
});

describe('测试p2p协议', function(done){
  this.timeout(5000);
  var mobile = '11168681008';

  before(function () {
    return userService.$login(mobile, '123456').then(function (result) {
      HttpService.$getDefaultService().$setUserInfo(result);
    });
  });

  it('p2p小项目 protocal should return code(0)', function(){
    return protocalService.$getP2PProtocal('p2p', 'PS1001', 'ps1022').should.eventually.satisfy(function(obj){
      return obj.message.code == 0
    }).notify(done);
  });

});

